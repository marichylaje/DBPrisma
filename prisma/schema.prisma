// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")         // Accelerate (runtime)
  directUrl = env("DIRECT_DATABASE_URL")  // Neon directo (migraciones)
}

generator client {
  provider = "prisma-client-js"
}

model UserEntitlement {
  userKey              String   @id

  // Suscripción
  subActive            Boolean  @default(false)
  subPlatform          String?
  subProductId         String?
  subExpiry            DateTime?

  // Android pendiente
  pendingAndroid       Boolean  @default(false)
  androidPurchaseToken String?
  lastVerifyAt         DateTime?
  verifyError          String?

  // Trial
  trialGranted         Boolean  @default(false)
  trialStart           DateTime?
  trialExpiry          DateTime?

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model UserDeck {
  id               String   @id @default(cuid())
  userKey          String
  deckName         String
  deckDescription  String?  @db.Text
  instagram        String?

  commanderName    String
  commanderId      String?  // Scryfall ID si lo tienes
  partnerName      String?
  partnerId        String?  // Scryfall ID si lo tienes

  // Lista compacta: [{ name: "...", count: 1 }, ...]
  cards            Json

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userKey])
  @@unique([userKey, deckName]) // 1 nombre único por usuario
}
